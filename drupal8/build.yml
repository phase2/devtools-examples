# Container for starting a cli for build commands
# Usage: docker-compose -f build.yml run cli
cli:
  image: phase2/devtools-build:php70
  working_dir: /code
  command: /bin/bash
  volumes:
    - .:/code/
    - ./html:/var/www/html
  external_links:
    - drupal8_db_1:db

# Container for running drush in the docroot.
# Usage: docker-compose -f build.yml run drush <command>
# Where <command> is a direct drush command like cache-rebuild
drush:
  image: phase2/devtools-build:php70
  entrypoint: [ "/init", "drush" ]
  working_dir: /var/www/html
  volumes:
    - ./html:/var/www/html
  external_links:
    - drupal8_db_1:db

# Container for running grunt in the docroot.
# Usage: docker-compose -f build.yml run grunt <command>
grunt:
  image: phase2/devtools-build:php70
  entrypoint: [ "/init", "grunt" ]
  working_dir: /code
  volumes:
    - .:/code/
    - ./html:/var/www/html
  external_links:
    - drupal8_db_1:db

# Container for the drush make command to build the site    
# Usage: docker-compose -f build.yml run make
make:
  image: phase2/devtools-build:php70
  working_dir: /code
  command: drush make ./drupal8.make.yml ./html 
  volumes:
    - .:/code/

# Reuse from our dev environment
db:
  extends:
    file: docker-compose.yml
    service: db

